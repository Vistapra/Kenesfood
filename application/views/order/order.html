<!-- Main Container -->
<div class="container-fluid">
	<!-- Customer Identity Section -->
	<section class="section-padding" id="identity-page">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-md-6">
					<div class="card">
						<div class="card-body">
							<div class="logo-container">
								<img src="{$BASEURL}resource/assets-frontend/dist/logo/logo_Kenes_teristimewa-01_(1).png"
									alt="Logo" class="logo">
							</div>
							<h4 class="text-center mb-4">Welcome to {$outlet.outlet_name}</h4>
							<div class="form-group mb-4">
								<label class="form-label">Name</label>
								<input type="text" class="form-control" id="inputCustomerName" required>
							</div>
							<div class="form-group mb-4">
								<label class="form-label">Passcode</label>
								<input type="password" class="form-control" id="inputPasscode" required minlength="4">
								<small class="text-muted">Minimum 4 characters</small>
							</div>
							<button type="button" class="btn btn-primary w-100" id="submitCustomerInfo">
								Start Order
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Outlet Info Section -->
	<section class="outlet-info-section bg-light py-3 mb-3" id="outlet-info" style="display: none;">
		<div class="container">
			<div class="row">
				<div class="col-md-6">
					<h4 class="mb-2">{$outlet.outlet_name}</h4>
					<p class="mb-1"><i class="fas fa-map-marker-alt me-2"></i>{$outlet.outlet_address}</p>
					<p class="mb-1"><i class="fas fa-clock me-2"></i>{$outlet.hour_open} - {$outlet.hour_close}</p>
					<p class="mb-0"><i class="fas fa-table me-2"></i>Table #{$table_id}</p>
				</div>
				<div class="col-md-6 text-md-end">
					<div class="customer-info">
						<h5 class="mb-0">Welcome, <span id="customer-name" class="text-primary"></span></h5>
						<small class="text-muted">Table #{$table_id}</small>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Main Order Section -->
	<section class="explore-section section-padding" id="order-page" style="display: none;">
		<div class="container">
			<!-- Navigation and Filters -->
			<div class="row mb-4">
				<div class="col-12 text-center">
					<h2 class="mb-4">Our Menu</h2>
				</div>
			</div>
			<div class="row align-items-center mb-4">
				<div class="col-md-4">
					<select id="category-select" class="form-select">
						<option value="all" selected>All Categories</option>
						{foreach from=$catalogueCategories key=key item=cat}
						<option value="{$cat.cat_id}">{$cat.cat_name}</option>
						{/foreach}
					</select>
				</div>
				<div class="col-md-4 text-center my-3 my-md-0">
					<button class="btn btn-primary position-relative me-3" id="show-cart">
						<i class="fa-solid fa-cart-shopping"></i>
						<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-success"
							id="count-cart">
							0
						</span>
					</button>
					<button class="btn btn-outline-primary" id="show-packages">
						<i class="fa-solid fa-box"></i> View Packages
					</button>
				</div>
			</div>

			<!-- Product Grid -->
			<div class="row" id="product-grid">
				{if !empty($product_mb)}
				{$categoryID = 0}
				{foreach from=$product_mb key=key item=prod}
				{if $categoryID != $prod.cat_id}
				{$categoryID = {$prod.cat_id}}
				<div class="col-12 mb-4">
					<div class="category-header bg-primary text-white p-3 rounded">
						<h4 class="mb-0">{$prod.cat_name}</h4>
					</div>
				</div>
				{/if}
				<div class="col-6 col-md-4 col-lg-3 mb-4">
					<div class="card product-card h-100">
						<div class="position-relative">
							<img src="{$BASEURL}resource/assets-frontend/dist/product/{$prod.product_pict}"
								class="card-img-top product-image" alt="{$prod.product_name}"
								style="height: 200px; object-fit: cover;">
							{if $prod.stock == 0}
							<div class="sold-out-overlay">
								<span class="badge bg-danger">Sold Out</span>
							</div>
							{/if}
						</div>
						<div class="card-body">
							<h5 class="card-title">{$prod.product_name}</h5>
							<p class="card-text">
								<span class="price">Rp {$prod.price_catalogue}K</span>
								{if $prod.stock > 0}
								<small class="text-success">Stock: {$prod.stock}</small>
								{/if}
							</p>
							<button class="btn btn-primary w-100 add-to-cart" data-product-id="{$prod.product_id}" {if
								$prod.stock==0}disabled{/if}>
								Add to Cart
							</button>
						</div>
					</div>
				</div>
				{/foreach}
				{/if}
			</div>
		</div>
	</section>
</div>

<!-- Modals -->
<!-- Package Selection Modal -->
<div class="modal fade package-selection-modal" id="package-selection-modal" tabindex="-1">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Customize Your Package</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<!-- Package Information -->
				<div id="package-info" class="mb-4">
					<h5 class="package-name mb-2"></h5>
					<p class="package-description text-muted"></p>
				</div>

				<!-- Category Selection -->
				<div id="package-categories">
					{foreach from=$package_categories item=category}
					<div class="package-category mb-4" data-category-id="{$category.id}">
						<div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-3">
							<h6 class="mb-0">{$category.name}</h6>
							<div class="selection-count">
								<span class="selected">0</span>
								<span class="text-muted">/ {$category.required_qty} items</span>
							</div>
						</div>
						<div class="package-items row g-3">
							<!-- Items will be dynamically loaded here -->
							<div class="col-md-4 template-item d-none">
								<div class="card h-100 selectable-item">
									<img src="" class="card-img-top" style="height: 120px; object-fit: cover;">
									<div class="card-body">
										<h6 class="card-title item-name"></h6>
										<div class="d-flex justify-content-between align-items-center">
											<span class="price"></span>
											<div class="quantity-selector d-none">
												<div class="input-group input-group-sm">
													<button class="btn btn-outline-secondary decrease-qty"
														type="button">-</button>
													<input type="number" class="form-control text-center item-quantity"
														value="0" min="0">
													<button class="btn btn-outline-secondary increase-qty"
														type="button">+</button>
												</div>
											</div>
											<button class="btn btn-sm btn-outline-primary select-item">Select</button>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!-- Category Progress -->
						<div class="progress mt-3" style="height: 5px;">
							<div class="progress-bar" role="progressbar" style="width: 0%"></div>
						</div>
					</div>
					{/foreach}
				</div>

				<!-- Excluded Products -->
				<div class="excluded-products mt-4" id="excluded-products-section" style="display: none;">
					<h6 class="text-danger border-bottom pb-2">Excluded Items</h6>
					<ul id="excluded-items-list" class="list-unstyled mt-2">
						<!-- Excluded items will be dynamically populated -->
					</ul>
				</div>

				<!-- Package Summary -->
				<div class="package-summary mt-4">
					<div class="card">
						<div class="card-body">
							<h6 class="card-title border-bottom pb-2">Package Summary</h6>
							<!-- Selected Items Summary -->
							<div id="selected-items-summary">
								<div class="selected-items-list">
									<!-- Selected items will be dynamically populated -->
								</div>
							</div>
							<!-- Package Totals -->
							<div class="package-totals mt-3 pt-3 border-top">
								<div class="d-flex justify-content-between mb-2">
									<span>Base Package Price:</span>
									<span class="base-price">Rp 0</span>
								</div>
								<div class="d-flex justify-content-between mb-2">
									<span>Additional Items:</span>
									<span class="additional-price">Rp 0</span>
								</div>
								<div class="d-flex justify-content-between fw-bold">
									<span>Total Price:</span>
									<span class="total-price">Rp 0</span>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Validation Messages -->
				<div id="package-validation-messages" class="mt-3">
					<!-- Validation messages will appear here -->
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary" id="add-package" disabled>
					Add Package to Cart
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Package Browse Modal -->
<div class="modal fade" id="package-browse-modal" tabindex="-1">
	<div class="modal-dialog modal-xl">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Available Packages</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="container">
					<div class="row">
						{foreach from=$packages item=package}
						<div class="col-md-6 col-lg-4 mb-4">
							<div class="card h-100">
								<div class="card-body">
									<h5 class="card-title">{$package.name}</h5>
									<p class="card-text">{$package.description}</p>
									<div class="package-details">
										<h6>Package Contents:</h6>
										<ul class="list-unstyled">
											{foreach from=$package.categories item=category}
											<li>
												<i class="fas fa-check-circle text-success me-2"></i>
												<span class="fw-bold">{$category.name}:</span>
												Choose {$category.quantity} items
											</li>
											{/foreach}
										</ul>
									</div>
									<button class="btn btn-primary w-100 select-package" data-package-id="{$package.id}"
										data-bs-toggle="modal" data-bs-target="#package-selection-modal">
										Select Package
									</button>
								</div>
							</div>
						</div>
						{/foreach}
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Cart Modal -->
<div class="modal fade" id="cart-modal" tabindex="-1">
	<div class="modal-dialog modal-xl modal-dialog-scrollable">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Shopping Cart</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="container">
					<!-- Regular Items -->
					<div class="regular-items mb-4">
						<h6 class="border-bottom pb-2">Regular Items</h6>
						<div class="table-responsive">
							<table class="table table-hover">
								<thead>
									<tr>
										<th>Product</th>
										<th>Price</th>
										<th>Quantity</th>
										<th>Notes</th>
										<th>Subtotal</th>
										<th>Actions</th>
									</tr>
								</thead>
								<tbody id="regular-items-list">
									<!-- Cart items will be loaded dynamically -->
								</tbody>
							</table>
						</div>
					</div>

					<!-- Package Items -->
					<div class="package-items mb-4">
						<h6 class="border-bottom pb-2">Package Items</h6>
						<div id="package-items-container">
							<!-- Package items will be loaded dynamically -->
						</div>
					</div>

					<!-- Cart Summary -->
					<div class="cart-summary">
						<div class="card">
							<div class="card-body">
								<div class="row">
									<div class="col-md-6">
										<h6>Order Summary</h6>
										<div class="d-flex justify-content-between mb-2">
											<span>Total Items:</span>
											<span id="cart-total-items">0</span>
										</div>
										<div class="d-flex justify-content-between mb-2">
											<span>Regular Items:</span>
											<span id="cart-regular-items">0</span>
										</div>
										<div class="d-flex justify-content-between">
											<span>Package Items:</span>
											<span id="cart-package-items">0</span>
										</div>
									</div>
									<div class="col-md-6 text-end">
										<h6>Total Amount</h6>
										<h3 id="cart-total-amount">Rp 0</h3>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Shopping</button>
				<button type="button" class="btn btn-success" id="place-order">Place Order</button>
			</div>
		</div>
	</div>
</div>

<!-- Order Success Modal -->
<div class="modal fade" id="order-success-modal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header bg-success text-white">
				<h5 class="modal-title">Order Placed Successfully!</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="text-center mb-4">
					<i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
				</div>
				<div class="order-details">
					<div class="card">
						<div class="card-body">
							<h6 class="card-title">Order Details</h6>
							<div class="row mb-2">
								<div class="col-5">Receipt Number:</div>
								<div class="col-7 text-end" id="receipt-number"></div>
							</div>
							<div class="row mb-2">
								<div class="col-5">Order ID:</div>
								<div class="col-7 text-end" id="order-id"></div>
							</div>
							<div class="row mb-2">
								<div class="col-5">Total Amount:</div>
								<div class="col-7 text-end" id="final-amount"></div>
							</div>
							<div class="row">
								<div class="col-5">Order Time:</div>
								<div class="col-7 text-end" id="order-time"></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Done</button>
			</div>
		</div>
	</div>
</div>

<!-- Add Note Modal -->
<div class="modal fade" id="add-note-modal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add Note</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<input type="hidden" id="note-product-id">
				<div class="form-group">
					<label>Special Instructions</label>
					<textarea class="form-control" id="item-note" rows="3"
						placeholder="Ex: No sugar, extra spicy, etc"></textarea>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn btn-primary" id="save-note">Save Note</button>
			</div>
		</div>
	</div>
</div>

<!-- Loading State Modal -->
<div class="modal fade" id="loading-modal" data-bs-backdrop="static" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-body text-center py-4">
				<div class="spinner-border text-primary mb-3"></div>
				<h5 class="mb-0">Processing your request...</h5>
			</div>
		</div>
	</div>
</div>

<!-- Error Modal -->
<div class="modal fade" id="error-modal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header bg-danger text-white">
				<h5 class="modal-title">Error</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="text-center">
					<i class="fas fa-exclamation-circle text-danger" style="font-size: 3rem;"></i>
					<h5 class="mt-3" id="error-message">Something went wrong</h5>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<!-- No Internet Connection Modal -->
<div class="modal fade" id="connection-modal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header bg-danger text-white">
				<h5 class="modal-title"><i class="fas fa-wifi-slash me-2"></i>No Internet Connection</h5>
			</div>
			<div class="modal-body text-center">
				<i class="fas fa-cloud-slash text-danger mb-3" style="font-size: 3rem;"></i>
				<h5>Unable to connect to server</h5>
				<p>Please check your internet connection and try again.</p>
				<button class="btn btn-primary" id="retry-connection">
					<i class="fas fa-sync me-2"></i>Retry Connection
				</button>
			</div>
		</div>
	</div>
</div>

<!-- Operating Hours Warning Modal -->
<div class="modal fade" id="operating-hours-modal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header bg-warning">
				<h5 class="modal-title">Operating Hours Notice</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="text-center">
					<i class="fas fa-clock text-warning mb-3" style="font-size: 3rem;"></i>
					<h5>Outlet is currently closed</h5>
					<p>Operating Hours:</p>
					<h6><span id="operating-hours"></span></h6>
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" data-bs-dismiss="modal">Okay</button>
			</div>
		</div>
	</div>
</div>

<!-- Order Confirmation Modal -->
<div class="modal fade" id="confirm-order-modal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Confirm Order</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<div class="order-confirmation-summary">
					<h6>Order Summary</h6>
					<div class="table-responsive">
						<table class="table table-sm">
							<tbody>
								<tr>
									<td>Regular Items:</td>
									<td class="text-end" id="confirm-regular-items">0</td>
								</tr>
								<tr>
									<td>Package Items:</td>
									<td class="text-end" id="confirm-package-items">0</td>
								</tr>
								<tr>
									<td>Total Items:</td>
									<td class="text-end" id="confirm-total-items">0</td>
								</tr>
								<tr>
									<td><strong>Total Amount:</strong></td>
									<td class="text-end"><strong id="confirm-total-amount">Rp 0</strong></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="alert alert-info mt-3">
					<i class="fas fa-info-circle me-2"></i>
					Please confirm your order. Orders cannot be modified after submission.
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Review Order</button>
				<button type="button" class="btn btn-success" id="submit-final-order">
					<i class="fas fa-check me-2"></i>Confirm Order
				</button>
			</div>
		</div>
	</div>
</div>

<!-- CSS Styles -->
<style>
	/* General Styles */
	:root {
		--primary-color: #61411e;
		/* Deep Brown */
		--primary-hover: #4a3217;
		/* Darker Brown */
		--secondary-color: #8B5A2B;
		/* Medium Brown */
		--accent-color: #D2B48C;
		/* Soft Tan */
		--bg-color: #f8f9fa;
		/* Light Gray */
		--card-shadow: 0 12px 25px rgba(0, 0, 0, 0.1);
	}

	body {
		background-color: var(--bg-color);
		font-family: 'Arial', sans-serif;
		color: var(--primary-color);
		line-height: 1.6;
	}

	/* Card Styles */
	.card {
		border: none;
		border-radius: 15px;
		box-shadow: var(--card-shadow);
		transition: all 0.3s ease;
		background: rgba(255, 255, 255, 0.98);
		overflow: hidden;
	}

	.card:hover {
		transform: translateY(-10px);
		box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
	}

	.card-body {
		padding: 1.5rem;
		position: relative;
	}

	/* Product Card Specific */
	.product-card {
		position: relative;
	}

	.product-card .product-image {
		transition: transform 0.3s ease;
	}

	.product-card:hover .product-image {
		transform: scale(1.05);
	}

	/* Button Styles */
	.btn-primary {
		background-color: var(--primary-color);
		border-color: var(--primary-color);
		padding: 0.75rem 1.25rem;
		border-radius: 10px;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 1px;
		transition: all 0.3s ease;
		position: relative;
		overflow: hidden;
	}

	.btn-primary:before {
		content: '';
		position: absolute;
		top: 0;
		left: -100%;
		width: 100%;
		height: 100%;
		background: linear-gradient(120deg, transparent, rgba(255, 255, 255, 0.3), transparent);
		transition: all 0.3s ease;
	}

	.btn-primary:hover:before {
		left: 100%;
	}

	.btn-primary:hover {
		background-color: var(--primary-hover);
		transform: translateY(-3px);
		box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
	}

	/* Category Header */
	.category-header {
		background-color: var(--primary-color) !important;
		color: white !important;
		padding: 1rem;
		border-radius: 10px;
		position: relative;
		overflow: hidden;
	}

	.category-header:before {
		content: '';
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: linear-gradient(45deg, rgba(0, 0, 0, 0.1), transparent);
	}

	/* Form Styles */
	.form-control {
		border: 2px solid var(--accent-color);
		border-radius: 10px;
		padding: 0.75rem 1rem;
		background-color: rgba(210, 180, 140, 0.05);
		transition: all 0.3s ease;
	}

	.form-control:focus {
		border-color: var(--primary-color);
		box-shadow: 0 0 0 0.2rem rgba(97, 65, 30, 0.1);
	}

	/* Logo Styling */
	.logo-container {
		display: flex;
		justify-content: center;
		align-items: center;
		margin-bottom: 2rem;
		position: relative;
	}

	.logo {
		max-width: 200px;
		height: auto;
		border-radius: 15px;
		box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
		transition: transform 0.3s ease;
	}

	.logo:hover {
		transform: scale(1.05);
	}

	/* Responsive Adjustments */
	@media (max-width: 768px) {
		.card-body {
			padding: 1rem;
		}
	}

	/* Added Subtle Animations */
	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(20px);
		}

		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.card,
	.category-header {
		animation: fadeIn 0.5s ease forwards;
	}
</style>

<!-- Required Scripts -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>
<script src="{$BASEURL}resource/assets-frontend/js/order.js"></script>